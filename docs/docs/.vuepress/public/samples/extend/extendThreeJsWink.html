<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mx3PointArc 示例</title>
    <link rel="stylesheet" href="../index.css">
    <script src="../three.js"></script>
</head>

<script type="module">
    import Mx from "../mxdraw.esm.js"
    import { addEllipseShapeGui } from "../addShapeGui.js"
    import GUI from "../lil-gui.module.js"

    Mx.loadCoreCode().then(() => {
        Mx.MxFun.setIniset({
            // 启用对象选择功能.
            EnableIntelliSelect: true,
            // 选择类型
            IntelliSelectType: 1,
            // 是否开启多个选择
            multipleSelect: false,
        });
        // 创建控件对象
        Mx.MxFun.createMxObject({
            canvasId: "mxcad", // canvas元素的id
            useWebsocket: false,
            callback: (mxDrawObject, { canvas, canvasParent }) => {

            },
        });
        draw_twinkle(new THREE.Vector3(-10, 10, 0) )
    });
    async function draw_twinkle(point) {

        // 获取当前mxobj对象
        let mxobj = Mx.MxFun.getCurrentDraw();
        let pt;
        if (!point) {
            // 设置svg插入点
            const getPoint = new Mx.MrxDbgUiPrPoint();
            getPoint.setMessage("\n点取插入位置:");
            pt = await getPoint.go();
            if (!pt) return;
        }else{
            pt = point.clone();
        }
        // 设置svg缩放因子
        let dScale = Mx.MxFun.screenCoordLong2Doc(100);
        // 设置svg初始颜色
        let color = new THREE.Color(0xff4e95); //修改加载svg模型的颜色，undefined则默认svg本身颜色

        // 加载SVG
        Mx.MxThreeJS.loadSVG(
            '../../svg/mark.svg',
            color,
            (obj, meterials) => {
                if (obj) {
                    obj.scale.multiplyScalar(dScale / 1000);
                    obj.position.x = pt.x;
                    obj.position.y = pt.y;
                    obj.scale.y *= -1;
                    obj.renderOrder = 12000;
                    mxobj.addObject(obj, true);
                    // 启动一个时钟，随机修改模型材质的颜色实现闪烁效果
                    setInterval(() => {
                        // 设置随机颜色
                        const color = 0xffffff * Math.random();
                        meterials.forEach(item => { item.color.set(color) });
                        mxobj.updateDisplay();
                    }, 500);
                }
            }
        );
    }
    const gui = new GUI();
    
    const myObject3 = {
        executeTheCommand: () => draw_twinkle()
    }
    gui.add(myObject3, 'executeTheCommand').name('闪烁');
</script>

<body>
    <div class="mxdiv">
        <canvas id="mxcad"></canvas>
    </div>

</body>


</html>